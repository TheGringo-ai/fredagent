{% extends "base.html" %}
{% block title %}Log Query{% endblock %}
{% block content %}
<h2>ðŸ§  Query Logs</h2>

<form id="logQueryForm">
  <textarea id="query" name="query" rows="4" placeholder="Ask about previous logs..."></textarea>
  <button type="submit">Search Logs</button>
</form>

<pre id="logQueryOutput">Log insights will appear here...</pre>

<script>
  const form = document.getElementById("logQueryForm");
  const output = document.getElementById("logQueryOutput");

  form.addEventListener("submit", async (e) => {
    e.preventDefault();
    const query = document.getElementById("query").value;
    output.textContent = "Querying...";

    const response = await fetch("/log/query", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ query }),
    });
    const reader = response.body.getReader();
    const decoder = new TextDecoder();
    let text = "";

    while (true) {
      const { done, value } = await reader.read();
      if (done) break;
      text += decoder.decode(value, { stream: true });
      output.textContent = text;
      output.scrollTop = output.scrollHeight;
    }
  });
</script>
{% endblock %}
